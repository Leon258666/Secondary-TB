import shap
import numpy as np
import matplotlib.pyplot as plt
import pandas as pd

certain_feature_names = ['CC_deepfeature_1', 'CC_deepfeature_2', 'CC_deepfeature_3', 'CC_deepfeature_4', 'CC_deepfeature_5', 'CC_deepfeature_6', 'CC_deepfeature_7', 'CC_deepfeature_8', 'CC_deepfeature_9', 'CC_deepfeature_10', 'CC_deepfeature_11', 'CC_deepfeature_12', 'CC_deepfeature_13', 'CC_deepfeature_14', 'CC_deepfeature_15', 'CC_deepfeature_16', 'CC_deepfeature_17', 'CC_deepfeature_18', 'CC_deepfeature_19', 'CC_deepfeature_20', 'CC_deepfeature_21', 'CC_deepfeature_22', 'CC_deepfeature_23', 'CC_deepfeature_24', 'CC_deepfeature_25', 'CC_deepfeature_26', 'CC_deepfeature_27', 'CC_deepfeature_28', 'CC_deepfeature_29', 'CC_deepfeature_30', 'CC_deepfeature_31', 'CC_deepfeature_32', 'CC_deepfeature_33', 'CC_deepfeature_34', 'CC_deepfeature_35', 'CC_deepfeature_36', 'CC_deepfeature_37', 'CC_deepfeature_38', 'CC_deepfeature_39', 'CC_deepfeature_40', 'CC_deepfeature_42', 'CC_deepfeature_43', 'CC_deepfeature_44', 'CC_deepfeature_45', 'CC_deepfeature_46', 'CC_deepfeature_47', 'CC_deepfeature_48', 'CC_deepfeature_49', 'CC_deepfeature_50', 'CC_deepfeature_51', 'CC_deepfeature_52', 'CC_deepfeature_53', 'CC_deepfeature_54', 'CC_deepfeature_55', 'CC_deepfeature_56', 'CC_deepfeature_57', 'CC_deepfeature_58', 'CC_deepfeature_59', 'CC_deepfeature_60', 'CC_deepfeature_61', 'CC_deepfeature_62', 'CC_deepfeature_63', 'CC_deepfeature_64', 'CC_deepfeature_66', 'CC_deepfeature_67', 'CC_deepfeature_68', 'CC_deepfeature_69', 'CC_deepfeature_70', 'CC_deepfeature_71', 'CC_deepfeature_72', 'CC_deepfeature_73', 'CC_deepfeature_74', 'CC_deepfeature_75', 'CC_deepfeature_76', 'CC_deepfeature_77', 'CC_deepfeature_78', 'CC_deepfeature_79', 'CC_deepfeature_80', 'CC_deepfeature_81', 'CC_deepfeature_82', 'CC_deepfeature_83', 'CC_deepfeature_84', 'CC_deepfeature_85', 'CC_deepfeature_86', 'CC_deepfeature_87', 'CC_deepfeature_88', 'CC_deepfeature_89', 'CC_deepfeature_90', 'CC_deepfeature_91', 'CC_deepfeature_92', 'CC_deepfeature_93', 'CC_deepfeature_94', 'CC_deepfeature_95', 'CC_deepfeature_96', 'CC_deepfeature_97', 'CC_deepfeature_98', 'CC_deepfeature_99', 'CC_deepfeature_100', 'CC_deepfeature_101', 'CC_deepfeature_102', 'CC_deepfeature_103', 'CC_deepfeature_104', 'CC_deepfeature_105', 'CC_deepfeature_106', 'CC_deepfeature_107', 'CC_deepfeature_108', 'CC_deepfeature_109', 'CC_deepfeature_110', 'CC_deepfeature_111', 'CC_deepfeature_112', 'CC_deepfeature_113', 'CC_deepfeature_114', 'CC_deepfeature_115', 'CC_deepfeature_116', 'CC_deepfeature_117', 'CC_deepfeature_118', 'CC_deepfeature_119', 'CC_deepfeature_120', 'CC_deepfeature_121', 'CC_deepfeature_122', 'CC_deepfeature_123', 'CC_deepfeature_124', 'CC_deepfeature_125', 'CC_deepfeature_126', 'CC_deepfeature_127', 'CC_deepfeature_128', 'CC_deepfeature_129', 'CC_deepfeature_130', 'CC_deepfeature_131', 'CC_deepfeature_132', 'CC_deepfeature_133', 'CC_deepfeature_134', 'CC_deepfeature_135', 'CC_deepfeature_136', 'CC_deepfeature_137', 'CC_deepfeature_138', 'CC_deepfeature_139', 'CC_deepfeature_140', 'CC_deepfeature_141', 'CC_deepfeature_142', 'CC_deepfeature_143', 'CC_deepfeature_144', 'CC_deepfeature_145', 'CC_deepfeature_146', 'CC_deepfeature_147', 'CC_deepfeature_148', 'CC_deepfeature_149', 'CC_deepfeature_150', 'CC_deepfeature_151', 'CC_deepfeature_152', 'CC_deepfeature_153', 'CC_deepfeature_154', 'CC_deepfeature_155', 'CC_deepfeature_156', 'CC_deepfeature_157', 'CC_deepfeature_158', 'CC_deepfeature_159', 'CC_deepfeature_160', 'CC_deepfeature_161', 'CC_deepfeature_162', 'CC_deepfeature_163', 'CC_deepfeature_164', 'CC_deepfeature_165', 'CC_deepfeature_166', 'CC_deepfeature_167', 'CC_deepfeature_168', 'CC_deepfeature_169', 'CC_deepfeature_170', 'CC_deepfeature_171', 'CC_deepfeature_172', 'CC_deepfeature_173', 'CC_deepfeature_174', 'CC_deepfeature_175', 'CC_deepfeature_176', 'CC_deepfeature_177', 'CC_deepfeature_178', 'CC_deepfeature_179', 'CC_deepfeature_180', 'CC_deepfeature_181', 'CC_deepfeature_182', 'CC_deepfeature_183', 'CC_deepfeature_184', 'CC_deepfeature_185', 'CC_deepfeature_186', 'CC_deepfeature_187', 'CC_deepfeature_188', 'CC_deepfeature_189', 'CC_deepfeature_190', 'CC_deepfeature_191', 'CC_deepfeature_192', 'CC_deepfeature_193', 'CC_deepfeature_194', 'CC_deepfeature_195', 'CC_deepfeature_196', 'CC_deepfeature_197', 'CC_deepfeature_198', 'CC_deepfeature_199', 'CC_deepfeature_200', 'CC_deepfeature_201', 'CC_deepfeature_202', 'CC_deepfeature_203', 'CC_deepfeature_204', 'CC_deepfeature_205', 'CC_deepfeature_206', 'CC_deepfeature_207', 'CC_deepfeature_208', 'CC_deepfeature_209', 'CC_deepfeature_210', 'CC_deepfeature_211', 'CC_deepfeature_212', 'CC_deepfeature_213', 'CC_deepfeature_214', 'CC_deepfeature_215', 'CC_deepfeature_216', 'CC_deepfeature_217', 'CC_deepfeature_218', 'CC_deepfeature_219', 'CC_deepfeature_220', 'CC_deepfeature_221', 'CC_deepfeature_222', 'CC_deepfeature_223', 'CC_deepfeature_224', 'CC_deepfeature_225', 'CC_deepfeature_226', 'CC_deepfeature_227', 'CC_deepfeature_228', 'CC_deepfeature_229', 'CC_deepfeature_230', 'CC_deepfeature_231', 'CC_deepfeature_232', 'CC_deepfeature_233', 'CC_deepfeature_234', 'CC_deepfeature_235', 'CC_deepfeature_236', 'CC_deepfeature_237', 'CC_deepfeature_238', 'CC_deepfeature_239', 'CC_deepfeature_240', 'CC_deepfeature_241', 'CC_deepfeature_242', 'CC_deepfeature_243', 'CC_deepfeature_244', 'CC_deepfeature_245', 'CC_deepfeature_246', 'CC_deepfeature_247', 'CC_deepfeature_248', 'CC_deepfeature_249', 'CC_deepfeature_250', 'CC_deepfeature_251', 'CC_deepfeature_252', 'CC_deepfeature_253', 'CC_deepfeature_254', 'CC_deepfeature_255', 'CC_deepfeature_256', 'CC_deepfeature_257', 'CC_deepfeature_258', 'CC_deepfeature_259', 'CC_deepfeature_260', 'CC_deepfeature_261', 'CC_deepfeature_262', 'CC_deepfeature_263', 'CC_deepfeature_264', 'CC_deepfeature_265', 'CC_deepfeature_266', 'CC_deepfeature_267', 'CC_deepfeature_268', 'CC_deepfeature_270', 'CC_deepfeature_271', 'CC_deepfeature_272', 'CC_deepfeature_273', 'CC_deepfeature_274', 'CC_deepfeature_275', 'CC_deepfeature_276', 'CC_deepfeature_277', 'CC_deepfeature_278', 'CC_deepfeature_279', 'CC_deepfeature_280', 'CC_deepfeature_281', 'CC_deepfeature_282', 'CC_deepfeature_283', 'CC_deepfeature_284', 'CC_deepfeature_285', 'CC_deepfeature_286', 'CC_deepfeature_287', 'CC_deepfeature_288', 'CC_deepfeature_289', 'CC_deepfeature_290', 'CC_deepfeature_291', 'CC_deepfeature_292', 'CC_deepfeature_293', 'CC_deepfeature_294', 'CC_deepfeature_295', 'CC_deepfeature_296', 'CC_deepfeature_297', 'CC_deepfeature_298', 'CC_deepfeature_299', 'CC_deepfeature_301', 'CC_deepfeature_302', 'CC_deepfeature_303', 'CC_deepfeature_304', 'CC_deepfeature_305', 'CC_deepfeature_306', 'CC_deepfeature_307', 'CC_deepfeature_308', 'CC_deepfeature_309', 'CC_deepfeature_310', 'CC_deepfeature_311', 'CC_deepfeature_312', 'CC_deepfeature_313', 'CC_deepfeature_314', 'CC_deepfeature_315', 'CC_deepfeature_316', 'CC_deepfeature_317', 'CC_deepfeature_318', 'CC_deepfeature_319', 'CC_deepfeature_320', 'CC_deepfeature_321', 'CC_deepfeature_322', 'CC_deepfeature_323', 'CC_deepfeature_325', 'CC_deepfeature_326', 'CC_deepfeature_327', 'CC_deepfeature_328', 'CC_deepfeature_329', 'CC_deepfeature_330', 'CC_deepfeature_331', 'CC_deepfeature_332', 'CC_deepfeature_333', 'CC_deepfeature_334', 'CC_deepfeature_335', 'CC_deepfeature_336', 'CC_deepfeature_337', 'CC_deepfeature_338', 'CC_deepfeature_339', 'CC_deepfeature_340', 'CC_deepfeature_341', 'CC_deepfeature_342', 'CC_deepfeature_343', 'CC_deepfeature_344', 'CC_deepfeature_345', 'CC_deepfeature_346', 'CC_deepfeature_347', 'CC_deepfeature_348', 'CC_deepfeature_349', 'CC_deepfeature_350', 'CC_deepfeature_351', 'CC_deepfeature_352', 'CC_deepfeature_353', 'CC_deepfeature_354', 'CC_deepfeature_355', 'CC_deepfeature_356', 'CC_deepfeature_357', 'CC_deepfeature_359', 'CC_deepfeature_360', 'CC_deepfeature_361', 'CC_deepfeature_362', 'CC_deepfeature_363', 'CC_deepfeature_364', 'CC_deepfeature_365', 'CC_deepfeature_366', 'CC_deepfeature_367', 'CC_deepfeature_368', 'CC_deepfeature_369', 'CC_deepfeature_370', 'CC_deepfeature_371', 'CC_deepfeature_372', 'CC_deepfeature_373', 'CC_deepfeature_374', 'CC_deepfeature_375', 'CC_deepfeature_376', 'CC_deepfeature_377', 'CC_deepfeature_378', 'CC_deepfeature_379', 'CC_deepfeature_380', 'CC_deepfeature_381', 'CC_deepfeature_382', 'CC_deepfeature_383', 'CC_deepfeature_384', 'CC_deepfeature_385', 'CC_deepfeature_386', 'CC_deepfeature_387', 'CC_deepfeature_388', 'CC_deepfeature_389', 'CC_deepfeature_390', 'CC_deepfeature_391', 'CC_deepfeature_392', 'CC_deepfeature_393', 'CC_deepfeature_394', 'CC_deepfeature_395', 'CC_deepfeature_396', 'CC_deepfeature_397', 'CC_deepfeature_398', 'CC_deepfeature_399', 'CC_deepfeature_400', 'CC_deepfeature_401', 'CC_deepfeature_402', 'CC_deepfeature_403', 'CC_deepfeature_404', 'CC_deepfeature_405', 'CC_deepfeature_406', 'CC_deepfeature_407', 'CC_deepfeature_408', 'CC_deepfeature_409', 'CC_deepfeature_410', 'CC_deepfeature_411', 'CC_deepfeature_412', 'CC_deepfeature_413', 'CC_deepfeature_414', 'CC_deepfeature_415', 'CC_deepfeature_416', 'CC_deepfeature_417', 'CC_deepfeature_418', 'CC_deepfeature_419', 'CC_deepfeature_420', 'CC_deepfeature_421', 'CC_deepfeature_422', 'CC_deepfeature_423', 'CC_deepfeature_424', 'CC_deepfeature_425', 'CC_deepfeature_426', 'CC_deepfeature_427', 'CC_deepfeature_428', 'CC_deepfeature_429', 'CC_deepfeature_430', 'CC_deepfeature_431', 'CC_deepfeature_432', 'CC_deepfeature_433', 'CC_deepfeature_434', 'CC_deepfeature_435', 'CC_deepfeature_436', 'CC_deepfeature_437', 'CC_deepfeature_438', 'CC_deepfeature_439', 'CC_deepfeature_440', 'CC_deepfeature_441', 'CC_deepfeature_442', 'CC_deepfeature_443', 'CC_deepfeature_444', 'CC_deepfeature_445', 'CC_deepfeature_446', 'CC_deepfeature_448', 'CC_deepfeature_449', 'CC_deepfeature_450', 'CC_deepfeature_451', 'CC_deepfeature_452', 'CC_deepfeature_453', 'CC_deepfeature_454', 'CC_deepfeature_455', 'CC_deepfeature_456', 'CC_deepfeature_457', 'CC_deepfeature_458', 'CC_deepfeature_459', 'CC_deepfeature_460', 'CC_deepfeature_461', 'CC_deepfeature_462', 'CC_deepfeature_463', 'CC_deepfeature_464', 'CC_deepfeature_465', 'CC_deepfeature_466', 'CC_deepfeature_467', 'CC_deepfeature_468', 'CC_deepfeature_469', 'CC_deepfeature_470', 'CC_deepfeature_471', 'CC_deepfeature_472', 'CC_deepfeature_473', 'CC_deepfeature_474', 'CC_deepfeature_475', 'CC_deepfeature_476', 'CC_deepfeature_477', 'CC_deepfeature_478', 'CC_deepfeature_479', 'CC_deepfeature_480', 'CC_deepfeature_481', 'CC_deepfeature_482', 'CC_deepfeature_483', 'CC_deepfeature_484', 'CC_deepfeature_485', 'CC_deepfeature_486', 'CC_deepfeature_487', 'CC_deepfeature_488', 'CC_deepfeature_489', 'CC_deepfeature_490', 'CC_deepfeature_491', 'CC_deepfeature_492', 'CC_deepfeature_493', 'CC_deepfeature_494', 'CC_deepfeature_495', 'CC_deepfeature_496', 'CC_deepfeature_497', 'CC_deepfeature_498', 'CC_deepfeature_499', 'CC_deepfeature_500', 'CC_deepfeature_501', 'CC_deepfeature_502', 'CC_deepfeature_503', 'CC_deepfeature_504', 'CC_deepfeature_505', 'CC_deepfeature_506', 'CC_deepfeature_508', 'CC_deepfeature_509', 'CC_deepfeature_510', 'CC_deepfeature_511','gradient_firstorder_Kurtosis',
                        'square_glcm_ClusterShade',
'squareroot_gldm_LowGrayLevelEmphasis', 'squareroot_glrlm_LowGrayLevelRunEmphasis',
'wavelet-LHH_gldm_DependenceEntropy',
 'logarithm_firstorder_Energy', 'wavelet-LLL_firstorder_10Percentile', 'square_glcm_ClusterProminence',
 'squareroot_glrlm_RunEntropy',
'wavelet-LHH_glszm_ZonePercentage',
'wavelet-HHH_glcm_DifferenceVariance']





# 特征个数
    #  51:791 751 2:80 78 3:80 79 7:81 78 12:81 78 21:80 79 26:80 80 29:81 80 34: 83 76 35:83 82 39:82 79 43:83 80 68:81 81 74:81 80 92:82 80
# trian, test = train_test_split(df, test_size=0.3, random_state=32)
trian = pd.read_csv(r'C:\Users\69559\Desktop\deepfeatureNonormalize\combinetrain80pos.csv')
test = pd.read_csv(r'C:\Users\69559\Desktop\deepfeatureNonormalize\combinetest80pos.csv')
# trian.to_csv(r'C:\Users\69559\Desktop\deepfeatureNonormalize\combinetrain69pos.csv')  # 提取的特征写入excel中，提取的位置是什么
# test.to_csv(r'C:\Users\69559\Desktop\deepfeatureNonormalize\combinetest69pos.csv')  # 提取的特征写入excel中，提取的位置是什么
train_Xshap = trian[certain_feature_names]
test_Xshap = test[certain_feature_names]


certain_feature_names1 = pd.Series(certain_feature_names)

shap_values = np.load(r'C:\Users\69559\Desktop\deepfeatureNonormalize\80_shap_val.npy', allow_pickle=True)

shap_lst = [shap_values[i] for i in range(shap_values.shape[0])]
shap.summary_plot(shap_lst, features=test_Xshap.values, feature_names=certain_feature_names1, max_display=20, plot_type="bar", show=False)

shap.dependence_plot('square_glcm_ClusterShade', shap_lst[0], features=test_Xshap, show=True)

# save_path = r'C:\Users\69559\Desktop\shap\69bar.png'  # 自定义路径
# plt.savefig(save_path, dpi=800, bbox_inches='tight')  # 保存为 PDF 文件
# plt.close()  # 关闭当前图形


# shap.summary_plot(shap_values[0], test_Xshap, feature_names=certain_feature_names1, max_display=20, plot_type="dot", show=False)
# save_path = r'C:\Users\69559\Desktop\shap\69dot.png'  # 自定义路径
# plt.savefig(save_path, dpi=800, bbox_inches='tight')  # 保存为 PDF 文件
# plt.close()  # 关闭当前图形
